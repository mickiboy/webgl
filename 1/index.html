<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

    <title>WebGL Tutorial - Einrichtung</title>

    <link rel="stylesheet" href="/webgl_tutorial/semantic.min.css">
    <link rel="stylesheet" href="/webgl_tutorial/style.css">
  <link rel="stylesheet" href="/webgl_tutorial/css/prism.css" type="text/css"></head>

    <body>
<div class="ui vertical inverted sidebar menu">
    <a class="item" href="/webgl_tutorial/">Startseite</a>
    
    <a class="active item" href="/webgl_tutorial/1">Einrichtung</a>
    
    
    <a class="item" href="/webgl_tutorial/2">Shader</a>
    
    
    <a class="item" href="/webgl_tutorial/3">Transformationen</a>
    
    
    <a class="item" href="/webgl_tutorial/4">Szenegraph</a>
    
</div>

<div class="pusher">
    <div class="ui vertical post segment">
        <div class="ui container">
            <div class="ui secondary pointing menu">
                <a class="toc item"><i class="sidebar icon"></i></a>
                <a class="header item" href="/webgl_tutorial/">WebGL Tutorial</a>
                <div class="right menu">
                    
                    <a class="active item" href="/webgl_tutorial/1">Einrichtung</a>
                    
                    
                    <a class="item" href="/webgl_tutorial/2">Shader</a>
                    
                    
                    <a class="item" href="/webgl_tutorial/3">Transformationen</a>
                    
                    
                    <a class="item" href="/webgl_tutorial/4">Szenegraph</a>
                    
                </div>
            </div>
        </div>

        <div class="ui text container">
            <h1 class="ui header">Einrichtung</h1>
            <div class="ui info message"><div class="header">Hinweis</div>Falls Sie mehr Komfort benötigen, können Sie auch eine bereits eingerichtete Ordnerstruktur von <a href="https://github.com/mickiboy/webgl_template" target="_blank" rel="external">GitHub</a> klonen. Zusätzlich gibt es die Möglichkeit, den Browser automatisch neu laden zu lassen, sobald Sie Änderungen am Quellcode vornehmen.</div>

<p>Um mit WebGL durchzustarten, sollten wir nun schrittweise versuchen, ein einfaches, weißes Dreieck zu zeichnen. Dazu brauchen wir eine HTML-Datei, deren Körper lediglich aus einem Canvas bestehen kann. Zusätzlich müssen sowohl ein Vertex- als auch ein Fragment-Shader eingebettet werden. Was diese Shader sind und machen, wird im nächsten Tutorial erklärt. Es reicht, lediglich zu wissen, dass Shader kleine Programme sind, die wie C- oder C++-Programme kompiliert und gelinkt werden müssen.</p>
<p>Nachdem dies erledigt ist, erweitern wir unsere kleine Demo, indem wir ein simples Haus darstellen.</p>
<h2 id="HTML-und-CSS"><a href="#HTML-und-CSS" class="headerlink" title="HTML und CSS"></a>HTML und CSS</h2><p>Da dies ein Tutorial für WebGL ist, wird der Fokus auf JavaScript gelegt, deshalb hier beispielhaft ein vollständiges HTML-Dokument, inklusive Anpassungen per CSS:</p>
<pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>width<span class="token punctuation">=</span>device-width, initial-scale<span class="token punctuation">=</span>1, shrink-to-fit<span class="token punctuation">=</span>no<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>style.css<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>WebGL Template<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>webgl-canvas<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">></span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>vertex-shader<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>x-shader/x-vertex<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
      attribute vec3 a_position;

      void main() {
        gl_Position = vec4(a_position, 1.0);
      }
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>fragment-shader<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>x-shader/x-fragment<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
      precision mediump float;

      void main() {
        gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);
      }
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://cdnjs.cloudflare.com/ajax/libs/mathjs/3.12.0/math.min.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>helpers.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>script.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span>
</code></pre>
<pre class=" language-css"><code class="language-css"><span class="token selector">body </span><span class="token punctuation">{</span>
  <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector"><span class="token id">#webgl-canvas</span> </span><span class="token punctuation">{</span>
  <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">100</span>vw<span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">100</span>vh<span class="token punctuation">;</span>
  <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Um die Dateien lokal zu öffnen, müssen die Shader zwingend im HTML-Dokument eingebettet sein. Falls man die Shader in separate Dateien auslagern will, muss man einen lokalen Webserver einrichten, welches den Rahmen dieses Tutorials aber sprengen würde.</p>
<p>In der HTML-Datei befinden sich auch Verweise auf mehrere JavaScripts. Das erste ist Math.js, eine Bibliothek mit vielen nützlichen mathematischen Funktionen. Das zweite Skript enthält zwei Funktionen, die dafür sorgen, dass die oben angegebenen Shader kompiliert und gelinkt werden. Dieses Skript sieht so aus:</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">priv_compileShader</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> type<span class="token punctuation">,</span> source<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> shader <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createShader</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>

    gl<span class="token punctuation">.</span><span class="token function">shaderSource</span><span class="token punctuation">(</span>shader<span class="token punctuation">,</span> source<span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">compileShader</span><span class="token punctuation">(</span>shader<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> success <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getShaderParameter</span><span class="token punctuation">(</span>shader<span class="token punctuation">,</span> gl<span class="token punctuation">.</span>COMPILE_STATUS<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>success<span class="token punctuation">)</span> <span class="token keyword">return</span> shader<span class="token punctuation">;</span>

    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token function">getShaderInfoLog</span><span class="token punctuation">(</span>shader<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">deleteShader</span><span class="token punctuation">(</span>shader<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">/**
 * Creates a shader program from the given source code of the vertex and
 * fragment shader.
 *
 * @param gl WebGL context
 * @param vertexShader ID of the vertex shader
 * @param fragmentShader ID of the fragment shader
 * @return Program ID for WebGL
 */</span>
<span class="token keyword">function</span> <span class="token function">createShaderProgram</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> vertexShader<span class="token punctuation">,</span> fragmentShader<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> compiledVertexShader <span class="token operator">=</span> <span class="token function">priv_compileShader</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> gl<span class="token punctuation">.</span>VERTEX_SHADER<span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span>vertexShader<span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> compiledFragmentShader <span class="token operator">=</span> <span class="token function">priv_compileShader</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> gl<span class="token punctuation">.</span>FRAGMENT_SHADER<span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span>fragmentShader<span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> program <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createProgram</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    gl<span class="token punctuation">.</span><span class="token function">attachShader</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> compiledVertexShader<span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">attachShader</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> compiledFragmentShader<span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">linkProgram</span><span class="token punctuation">(</span>program<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> success <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getProgramParameter</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> gl<span class="token punctuation">.</span>LINK_STATUS<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>success<span class="token punctuation">)</span> <span class="token keyword">return</span> program<span class="token punctuation">;</span>

    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token function">getProgramInfoLog</span><span class="token punctuation">(</span>program<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">deleteProgram</span><span class="token punctuation">(</span>program<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Zu guter Letzt das wichtigste Skript, dort werden die WebGL-Funktionen aufgerufen.</p>
<h2 id="Initialisierung"><a href="#Initialisierung" class="headerlink" title="Initialisierung"></a>Initialisierung</h2><p>Um WebGL zu initialisieren, müssen wir ein Kontext erstellen. Dazu benötigen wir das Canvas-Element:</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"webgl-canvas"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Anschließend kann mit</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">"webgl"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>ein WebGL-Kontext erstellt werden. Alle WebGL-Funktionen werden nun über die <code>gl</code>-Variable aufgerufen.</p>
<h3 id="Koordinaten-ubergeben"><a href="#Koordinaten-ubergeben" class="headerlink" title="Koordinaten übergeben"></a>Koordinaten übergeben</h3><p>Nachdem der Kontext erstellt wurde, können wir anfangen, das Dreieck zu definieren. Dafür brauchen wir zuerst einen Puffer, der diese Koordinaten enthält:</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> positionBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Dieser Puffer muss nun an WebGL angebunden (aktiviert) werden, um diesen mit Daten zu füllen:</p>
<pre class=" language-js"><code class="language-js">gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>ARRAY_BUFFER<span class="token punctuation">,</span> positionBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Der erste Parameter gibt an, um welche Art von Puffer es sich handelt, der zweite Parameter erwartet den Puffer selbst.</p>
<p>Jetzt müssen wir die Koordinaten übergeben. Dazu muss ein eindimensionales Array erstellt und an WebGL übergeben werden:</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> vertices <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token comment" spellcheck="true">/** x, y, z */</span>
    <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true">/** Vertex bottom-left */</span>
    <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true">/** Vertex top-left */</span>
    <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true">/** Vertex bottom-right */</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>ARRAY_BUFFER<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span>vertices<span class="token punctuation">)</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span>STATIC_DRAW<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Der erste Parameter gibt wiederum an, um welche Art von Puffer es sich handelt, der zweite Parameter ein Float-Array (hier mit <code>Float32Array</code> erstellt, da WebGL zwingend ein Float-Array voraussetzt). Der letzte Parameter gibt an, wie oft sich diese Daten ändern werden. Da sich die Koordinaten nie ändern werden, wird hier ein <code>gl.STATIC_DRAW</code> übergeben. Damit wird WebGL mitgeteilt, wo die Daten im Arbeitsspeicher der GPU abgelegt werden, damit diese das Rendering optimieren kann.</p>
<p>Da WebGL mindestens einen Vertex- und einen Fragment-Shader erfordert, werden wir nun diese kompilieren und linken.</p>
<h3 id="Shader-kompilieren-und-linken"><a href="#Shader-kompilieren-und-linken" class="headerlink" title="Shader kompilieren und linken"></a>Shader kompilieren und linken</h3><p>Da wir bereits eine Funktion haben, die sich darum kümmert, brauchen wir lediglich</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> program <span class="token operator">=</span> <span class="token function">createShaderProgram</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> <span class="token string">"vertex-shader"</span><span class="token punctuation">,</span> <span class="token string">"fragment-shader"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>zu schreiben. Die letzten beiden Parameter stehen jeweils für die IDs, die wir im so HTML-Dokument angegeben haben.</p>
<p>Für die Koordinaten benötigen wir noch eine Anbindung an den Shader. Diese wird erstellt mit</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> positionAttributeLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">"a_position"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><code>a_position</code> ist ein Attribut, der später eine Koordinate enthält.</p>
<h2 id="Rendern"><a href="#Rendern" class="headerlink" title="Rendern"></a>Rendern</h2><p>Die nachfolgenden Schritte werden stets pro Frame vorgenommen.</p>
<h3 id="Kontext-an-Canvas-Grose-anpassen"><a href="#Kontext-an-Canvas-Grose-anpassen" class="headerlink" title="Kontext an Canvas-Größe anpassen"></a>Kontext an Canvas-Größe anpassen</h3><p>Damit WebGL jeweils mit dem Browser zusammen skaliert, muss der Viewport gesetzt werden:</p>
<pre class=" language-js"><code class="language-js">gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>clientWidth<span class="token punctuation">;</span>
gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>clientHeight<span class="token punctuation">;</span>

gl<span class="token punctuation">.</span><span class="token function">viewport</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="Hintergrundfarbe-setzen"><a href="#Hintergrundfarbe-setzen" class="headerlink" title="Hintergrundfarbe setzen"></a>Hintergrundfarbe setzen</h3><p>Dazu wird zuerst die Farbe gesetzt und anschließend der Bildspeicher mit dieser Farbe gefüllt:</p>
<pre class=" language-js"><code class="language-js">gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>COLOR_BUFFER_BIT<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Die erste Funktion setzt die Farbe und die zweite Funktion führt den Füllbefehl aus.</p>
<h3 id="Shader-aktivieren"><a href="#Shader-aktivieren" class="headerlink" title="Shader aktivieren"></a>Shader aktivieren</h3><p>Jetzt muss das zuvor erstellte Shader-Programm aktiviert werden und das Positionsattribut angebunden werden:</p>
<pre class=" language-js"><code class="language-js">gl<span class="token punctuation">.</span><span class="token function">useProgram</span><span class="token punctuation">(</span>program<span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>positionAttributeLocation<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="Koordinaten-Puffer-aktivieren"><a href="#Koordinaten-Puffer-aktivieren" class="headerlink" title="Koordinaten-Puffer aktivieren"></a>Koordinaten-Puffer aktivieren</h3><p>Der zuvor erstellte Puffer für die Koordinaten muss jetzt wieder aktiviert werden:</p>
<pre class=" language-js"><code class="language-js">gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>ARRAY_BUFFER<span class="token punctuation">,</span> positionBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>positionAttributeLocation<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span>FLOAT<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Der erste Parameter der zweiten Funktion enthält die Anbindung an das Attribut im Vertex-Shader, der zweite Parameter die Anzahl der Dimensionen (hier 3), der dritte Parameter den Variablentyp der Vertizen. Die anderen Parameter ignorieren wir vorerst.</p>
<h3 id="Zeichenbefehl-ubergeben"><a href="#Zeichenbefehl-ubergeben" class="headerlink" title="Zeichenbefehl übergeben"></a>Zeichenbefehl übergeben</h3><p>Jetzt kommt der eigentlich wichtigste Moment, das Zeichnen des Dreiecks:</p>
<pre class=" language-js"><code class="language-js">gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>TRIANGLES<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Der erste Parameter gibt an, auf welche Art er die zuvor angebundenen Koordinaten zeichen soll, der zweite Parameter den Offset im Array und der letzte Parameter die Anzahl der Koordinaten.</p>
<h3 id="Auf-Grosenveranderungen-des-Browserfensters-reagieren"><a href="#Auf-Grosenveranderungen-des-Browserfensters-reagieren" class="headerlink" title="Auf Größenveränderungen des Browserfensters reagieren"></a>Auf Größenveränderungen des Browserfensters reagieren</h3><p>Dazu teilen wir unseren Code in zwei Teile auf: einen Initialisierungsteil und einen Rendering-Teil. Das sollte ungefähr so aussehen:</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// Alles aus dem Abschnitt "Initialisierung" inkl. Unterabschnitte hier rein</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// Alles aus dem Abschnitt "Rendern" inkl. Unterabschnitte hier rein</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Dabei sollten Sie beachten, dass die Variablen nun global (außerhalb der Funktion) deklariert werden sollen.</p>
<p>Jetzt ergänzen Sie am Ende des gesamten Codes folgenden Funktionsaufruf:</p>
<pre class=" language-js"><code class="language-js"><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>render<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><code>requestAnimationFrame</code> sorgt dafür, dass die übergebene Funktion dann aufgerufen wird, sobald die Grafikkarte bereit zum Rendern ist. Da wir aber kontinuierlich rendern wollen (um auf die Größenänderungen zu reagieren), fügen wir diesen Funktionsaufruf auch am Ende der <code>render</code>-Funktion ein.</p>
<h2 id="Ein-Haus"><a href="#Ein-Haus" class="headerlink" title="Ein Haus"></a>Ein Haus</h2><p>Jetzt wollen wir versuchen, ein Haus darzustellen. Normalerweise würde man jetzt hingehen, jedes Dreieck einzeln zu definieren und den entsprechenden Parameter von <code>gl.drawArrays()</code> anzupassen:</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> vertices <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token comment" spellcheck="true">/** Linke Dachhälfte */</span>
    <span class="token number">0.0</span><span class="token punctuation">,</span>  <span class="token number">0.5</span><span class="token punctuation">,</span>  <span class="token number">0.0</span><span class="token punctuation">,</span>
    <span class="token number">0.25</span><span class="token punctuation">,</span> <span class="token number">0.75</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span>
    <span class="token number">0.25</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span>  <span class="token number">0.0</span><span class="token punctuation">,</span>

    <span class="token comment" spellcheck="true">/** Rechte Dachhälfte */</span>
    <span class="token number">0.25</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span>  <span class="token number">0.0</span><span class="token punctuation">,</span>
    <span class="token number">0.25</span><span class="token punctuation">,</span> <span class="token number">0.75</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span>
    <span class="token number">0.5</span><span class="token punctuation">,</span>  <span class="token number">0.5</span><span class="token punctuation">,</span>  <span class="token number">0.0</span><span class="token punctuation">,</span>

    <span class="token comment" spellcheck="true">/** ... */</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/** ... */</span>

gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>TRIANGLES<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Da dies sehr unübersichtlich werden kann und obendrein auch noch zu viel Overhead verursacht, wollen wir nun ein weiteres WebGL-Feature einsetzen.</p>
<h3 id="Vertizen-und-Indizen"><a href="#Vertizen-und-Indizen" class="headerlink" title="Vertizen und Indizen"></a>Vertizen und Indizen</h3><p>Man kann das ganze sich nämlich vereinfachen, indem man nur die Punkte genau einmal setzt und dann mit Index-Werten darauf zugreift. So könnte es aussehen:</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> vertices <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token number">0.0</span><span class="token punctuation">,</span>  <span class="token number">0.0</span><span class="token punctuation">,</span>  <span class="token number">0.0</span><span class="token punctuation">,</span>
    <span class="token number">0.0</span><span class="token punctuation">,</span>  <span class="token number">0.5</span><span class="token punctuation">,</span>  <span class="token number">0.0</span><span class="token punctuation">,</span>
    <span class="token number">0.25</span><span class="token punctuation">,</span> <span class="token number">0.75</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span>
    <span class="token number">0.5</span><span class="token punctuation">,</span>  <span class="token number">0.5</span><span class="token punctuation">,</span>  <span class="token number">0.0</span><span class="token punctuation">,</span>
    <span class="token number">0.5</span><span class="token punctuation">,</span>  <span class="token number">0.0</span><span class="token punctuation">,</span>  <span class="token number">0.0</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> indices <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token comment" spellcheck="true">/** Dach */</span>
    <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>

    <span class="token comment" spellcheck="true">/** Linke Haushälfte */</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>

    <span class="token comment" spellcheck="true">/** Rechte Haushälfte */</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre>
<p>Erstellen wir nun ein neuen Puffer für die Indizen, direkt nach dem Übertragen der Vertizen in den Vertex-Puffer:</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> positionIndexBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Nun übertragen wir die Indizen in diesen Puffer:</p>
<pre class=" language-js"><code class="language-js">gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>ELEMENT_ARRAY_BUFFER<span class="token punctuation">,</span> positionIndexBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>ELEMENT_ARRAY_BUFFER<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Uint16Array</span><span class="token punctuation">(</span>indices<span class="token punctuation">)</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span>STATIC_DRAW<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Zum Schluss ersetzen wir <code>drawArrays</code> mit folgenden Funktionen:</p>
<pre class=" language-js"><code class="language-js">gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>ELEMENT_ARRAY_BUFFER<span class="token punctuation">,</span> positionIndexBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">drawElements</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>TRIANGLES<span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span>UNSIGNED_SHORT<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Im nächsten Tutorial gehen wir näher auf die Shader ein, deren Verständnis wichtig ist für die darauffolgenden Tutorials.</p>

        </div>
    </div>
</div>

        <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
        <script src="/webgl_tutorial/semantic.min.js"></script>
        <script src="/webgl_tutorial/helpers.js"></script>
        <script src="/webgl_tutorial/script.js"></script>
    </body>
</html>
