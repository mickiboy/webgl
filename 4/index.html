<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

    <title>WebGL Tutorial - Szenegraph</title>

    <link rel="stylesheet" href="/webgl_tutorial/semantic.min.css">
    <link rel="stylesheet" href="/webgl_tutorial/style.css">
  <link rel="stylesheet" href="/webgl_tutorial/css/prism.css" type="text/css"></head>

    <body>
<div class="ui vertical inverted sidebar menu">
    <a class="item" href="/webgl_tutorial/">Startseite</a>
    
    <a class="item" href="/webgl_tutorial/1">Einrichtung</a>
    
    
    <a class="item" href="/webgl_tutorial/2">Shader</a>
    
    
    <a class="item" href="/webgl_tutorial/3">Transformationen</a>
    
    
    <a class="item" href="/webgl_tutorial/4">Szenegraph</a>
    
</div>

<div class="pusher">
    <div class="ui vertical post segment">
        <div class="ui container">
            <div class="ui secondary pointing menu">
                <a class="toc item"><i class="sidebar icon"></i></a>
                <a class="header item" href="/webgl_tutorial/">WebGL Tutorial</a>
                <div class="right menu">
                    
                    <a class="item" href="/webgl_tutorial/1">Einrichtung</a>
                    
                    
                    <a class="item" href="/webgl_tutorial/2">Shader</a>
                    
                    
                    <a class="item" href="/webgl_tutorial/3">Transformationen</a>
                    
                    
                    <a class="item" href="/webgl_tutorial/4">Szenegraph</a>
                    
                </div>
            </div>
        </div>

        <div class="ui text container">
            <h1 class="ui header">Szenegraph</h1>
            <p>In WebGL gibt es keine eingebaute Möglichkeit für Szenegraphen. Daher müssen wir uns eigene Hilfsfunktionen schreiben, um einen Szenegraphen darzustellen.</p>
<h2 id="Struktur-erstellen"><a href="#Struktur-erstellen" class="headerlink" title="Struktur erstellen"></a>Struktur erstellen</h2><p>Zuerst benötigen wir eine Datenstruktur, mit deren Hilfe wir den Szenegraphen aufbauen können. Dazu definieren wir einen Knoten:</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> Node <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>children <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>localMatrix <span class="token operator">=</span> math<span class="token punctuation">.</span><span class="token function">eye</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>worldMatrix <span class="token operator">=</span> math<span class="token punctuation">.</span><span class="token function">eye</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>Nun benötigen wir eine Funktion, mit der man den Parent setzen kann:</p>
<pre class=" language-js"><code class="language-js">Node<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>setParent <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>parent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>parent<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>parent<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>parent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    parent<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span>parent <span class="token operator">=</span> parent<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>Jetzt brauchen wir die Möglichkeit, die Weltmatrix anhand der Lokalmatrizen der Kinder zu aktualisieren:</p>
<pre class=" language-js"><code class="language-js">Node<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>updateWorldMatrix <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>parentWorldMatrix<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>parentWorldMatrix<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>worldMatrix <span class="token operator">=</span> math<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>localMatrix<span class="token punctuation">,</span> parentWorldMatrix<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>localMatrix <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>worldMatrix<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">var</span> worldMatrix <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>worldMatrix<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    child<span class="token punctuation">.</span><span class="token function">updateWorldMatrix</span><span class="token punctuation">(</span>worldMatrix<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="Beispiel"><a href="#Beispiel" class="headerlink" title="Beispiel"></a>Beispiel</h2><p>Als einfaches Beispiel nehmen wir uns ein Rechteck, welches um 45 Grad rotiert und an zwei unterschiedlichen Positionen verschoben wird. Dazu:</p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// Ursprungsrechteck mit Rotation</span>
<span class="token keyword">var</span> rectangle0 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
rectangle0<span class="token punctuation">.</span>localMatrix <span class="token operator">=</span> math<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>math<span class="token punctuation">.</span><span class="token function">matrix</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">[</span>math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>math<span class="token punctuation">.</span><span class="token function">unit</span><span class="token punctuation">(</span><span class="token number">45</span><span class="token punctuation">,</span> <span class="token string">'deg'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span>math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>math<span class="token punctuation">.</span><span class="token function">unit</span><span class="token punctuation">(</span><span class="token number">45</span><span class="token punctuation">,</span> <span class="token string">'deg'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>math<span class="token punctuation">.</span><span class="token function">unit</span><span class="token punctuation">(</span><span class="token number">45</span><span class="token punctuation">,</span> <span class="token string">'deg'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>math<span class="token punctuation">.</span><span class="token function">unit</span><span class="token punctuation">(</span><span class="token number">45</span><span class="token punctuation">,</span> <span class="token string">'deg'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">]</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> rectangle0<span class="token punctuation">.</span>localMatrix<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// Rechteck 3 Einheiten vom Ursprungsrechteck entfernt</span>
<span class="token keyword">var</span> rectangle1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
rectangle1<span class="token punctuation">.</span>localMatrix <span class="token operator">=</span> math<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>math<span class="token punctuation">.</span><span class="token function">matrix</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">3.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">]</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> rectangle1<span class="token punctuation">.</span>localMatrix<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// Rechteck 1 Einheit vom Ursprungsrechteck entfernt</span>
<span class="token keyword">var</span> rectangle2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
rectangle2<span class="token punctuation">.</span>localMatrix <span class="token operator">=</span> math<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>math<span class="token punctuation">.</span><span class="token function">matrix</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">]</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> rectangle2<span class="token punctuation">.</span>localMatrix<span class="token punctuation">)</span><span class="token punctuation">;</span>

rectangle1<span class="token punctuation">.</span><span class="token function">setParent</span><span class="token punctuation">(</span>rectangle0<span class="token punctuation">)</span><span class="token punctuation">;</span>
rectangle2<span class="token punctuation">.</span><span class="token function">setParent</span><span class="token punctuation">(</span>rectangle0<span class="token punctuation">)</span><span class="token punctuation">;</span>

rectangle0<span class="token punctuation">.</span><span class="token function">updateWorldMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Nun befinden sich in den Rechtecken die jeweiligen Weltmatrizen, die man pro Rechteck dann mit der Ansichts- und Projektionsmatrix multipliziert, um diese Endmatrix dann an den Shader zu übergeben.</p>

        </div>
    </div>
</div>

        <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
        <script src="/webgl_tutorial/semantic.min.js"></script>
        <script src="/webgl_tutorial/helpers.js"></script>
        <script src="/webgl_tutorial/script.js"></script>
    </body>
</html>
