<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

    <title>WebGL Tutorial - Transformationen</title>

    <link rel="stylesheet" href="/webgl_tutorial/semantic.min.css">
    <link rel="stylesheet" href="/webgl_tutorial/style.css">
  <link rel="stylesheet" href="/webgl_tutorial/css/prism.css" type="text/css"></head>

    <body>
<div class="ui vertical inverted sidebar menu">
    <a class="item" href="/webgl_tutorial/">Startseite</a>
    
    <a class="item" href="/webgl_tutorial/1">Einrichtung</a>
    
    
    <a class="item" href="/webgl_tutorial/2">Shader</a>
    
    
    <a class="active item" href="/webgl_tutorial/3">Transformationen</a>
    
    
    <a class="item" href="/webgl_tutorial/4">Szenegraph</a>
    
</div>

<div class="pusher">
    <div class="ui vertical post segment">
        <div class="ui container">
            <div class="ui secondary pointing menu">
                <a class="toc item"><i class="sidebar icon"></i></a>
                <a class="header item" href="/webgl_tutorial/">WebGL Tutorial</a>
                <div class="right menu">
                    
                    <a class="item" href="/webgl_tutorial/1">Einrichtung</a>
                    
                    
                    <a class="item" href="/webgl_tutorial/2">Shader</a>
                    
                    
                    <a class="active item" href="/webgl_tutorial/3">Transformationen</a>
                    
                    
                    <a class="item" href="/webgl_tutorial/4">Szenegraph</a>
                    
                </div>
            </div>
        </div>

        <div class="ui text container">
            <h1 class="ui header">Transformationen</h1>
            <p>Sie wissen mittlerweile, was z. B. eine Projektions-Matrix ist, aber nicht, wie man diese jetzt in WebGL einbaut? Falls Sie jetzt noch nicht die ersten beiden Tutorials gelesen haben, sollten Sie das nun tun, da Sie das Wissen benötigen, um mit diesen Matrizen arbeiten zu können.</p>
<h2 id="Vorbereitung"><a href="#Vorbereitung" class="headerlink" title="Vorbereitung"></a>Vorbereitung</h2><p>Zuerst müssen wir die jeweiligen Matrizen als Uniform definieren:</p>
<pre class=" language-glsl"><code class="language-glsl"><span class="token keyword">uniform</span> <span class="token keyword">mat4</span> u_modelMatrix<span class="token punctuation">;</span>
<span class="token keyword">uniform</span> <span class="token keyword">mat4</span> u_viewMatrix<span class="token punctuation">;</span>
<span class="token keyword">uniform</span> <span class="token keyword">mat4</span> u_projectionMatrix<span class="token punctuation">;</span>
</code></pre>
<p>Danach multiplizieren wir die Matrizen mit der Vertex:</p>
<pre class=" language-glsl"><code class="language-glsl">gl_Position <span class="token operator">=</span> u_projectionMatrix <span class="token operator">*</span> u_viewMatrix <span class="token operator">*</span> u_modelMatrix <span class="token operator">*</span> <span class="token keyword">vec4</span><span class="token punctuation">(</span>a_position<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Jetzt speichern wir die ID der Uniforms in Variablen im Initialisierungsteil des WebGL-Codes:</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> modelMatrixUniformLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">"u_modelMatrix"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> viewMatrixUniformLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">"u_viewMatrix"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> projectionMatrixUniformLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">"u_projectionMatrix"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="Weltkoordinaten-Modell-Matrix"><a href="#Weltkoordinaten-Modell-Matrix" class="headerlink" title="Weltkoordinaten (Modell-Matrix)"></a>Weltkoordinaten (Modell-Matrix)</h2><p>Beispielhaft definieren wir hier eine Translations-, eine Rotations- und eine Skalierungsmatrix:</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> translation <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> rotation <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> scale <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre>
<p>Hier nehmen wir erstmal die Einheitsmatrizen der Einfachheit halber. Jetzt müssen diese Daten nur noch multipliziert, in ein eindimensionales Array umgewandelt und anschließend an die Uniform übergeben werden (im Rendering-Teil):</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> modelMatrix <span class="token operator">=</span> math<span class="token punctuation">.</span><span class="token function">chain</span><span class="token punctuation">(</span>math<span class="token punctuation">.</span><span class="token function">matrix</span><span class="token punctuation">(</span>translation<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>rotation<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>scale<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> modelMatrixData <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span>concat<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> modelMatrix<span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

gl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>modelMatrixUniformLocation<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> modelMatrixData<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="Kamera-und-Viewport-Koordinaten-Ansichts-und-Projektions-Matrizen"><a href="#Kamera-und-Viewport-Koordinaten-Ansichts-und-Projektions-Matrizen" class="headerlink" title="Kamera- und Viewport-Koordinaten (Ansichts- und Projektions-Matrizen)"></a>Kamera- und Viewport-Koordinaten (Ansichts- und Projektions-Matrizen)</h2><p>Diese kann man erstmal jeweils als Einheitsmatrix definieren und den jeweiligen Uniforms übergeben:</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> view <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> viewMatrix <span class="token operator">=</span> math<span class="token punctuation">.</span><span class="token function">matrix</span><span class="token punctuation">(</span>view<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> viewMatrixData <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span>concat<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> viewMatrix<span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

gl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>viewMatrixUniformLocation<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> viewMatrixData<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> projection <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> projectionMatrix <span class="token operator">=</span> math<span class="token punctuation">.</span><span class="token function">matrix</span><span class="token punctuation">(</span>projection<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> projectionMatrixData <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span>concat<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> projectionMatrix<span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

gl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>projectionMatrixUniformLocation<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> projectionMatrixData<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Das Endergebnis sollte nun identisch mit dem aus dem vorherigen Tutorial sein. Nun kann man aber seine berechneten Werte in die Matrizen eintragen und das Endergebnis “bestaunen”.</p>

        </div>
    </div>
</div>

        <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
        <script src="/webgl_tutorial/semantic.min.js"></script>
        <script src="/webgl_tutorial/helpers.js"></script>
        <script src="/webgl_tutorial/script.js"></script>
    </body>
</html>
